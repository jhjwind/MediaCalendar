<html lang="en">
<head>

<script type="text/javascript" src="jquery-1.4.2.js"></script>
<script type="text/javascript" src="tv_shows.js"></script>
<script type="text/javascript">
	var calTab = null;
	var vidTab = null;
	var calID = null;
	var desc = null;
	
  function gotoCalendar() {
    chrome.tabs.create({ url: "https://www.google.com/calendar/" });
    window.close();
  }
  
  function openShare() {
  	chrome.tabs.getSelected(null, function(tab) {
  	  vidTab = tab;
  	  var pageUrl = tab.url;
  	  
  	  if(pageUrl.match(/http:\/\/www.youtube.com\/watch\?v\=([A-Za-z0-9_]|\-){11}/)) {
  	  	//var calUrl = "http://www.google.com/calendar/render?tab=mc";
  	  	chrome.tabs.create({ url: "https://www.google.com/calendar/" }, function(t) {
  	  		calTab = t;
  	  		console.log('' + t.status);
  	  		setTimeout("postVideo()", 2000);
  	  	});
  	  }
  	  else {
  	  	//alert("This is not a YouTube video page.");
  	  }
  	});
  }
  
  function postVideo() {
  	var timeInfo = new Date();
  	
  	var year = timeInfo.getFullYear();
  	var month = timeInfo.getMonth() + 1;
  	var day = timeInfo.getDate();
  	var hours = timeInfo.getHours();
  	var mins = timeInfo.getMinutes();
  	var secs = timeInfo.getSeconds();
  	
  	var startTime = "" + year + "" + month + "" + day + "T" + hours + "" + mins + "" + secs;
  	var endTime = "/" + year + "" + month + "" + day + "T" + hours + "" + (mins + 1) + "" + secs;
  	var timeStr = startTime + endTime;
  	//var desc = ripDescription(tab);
  	
  	chrome.tabs.executeScript(vidTab.id, { code: "getVideoDescription()" }, null);
  	
  	var eventInfo = {
  	  sf: 'true',
  	  output: 'js',
  	  action: 'CREATE', 
  	  crm: 'BUSY',
  	  icc: 'PUBLIC',
  	  text: vidTab.title,
  	  location: vidTab.url,
  	  details: desc ? desc : 'N/A',
  	  dates: timeStr,
  	  src: calID,
  	  scp: 'ONE',
  	  secid: secid
  	}
  	
  	addEvent(eventInfo, null);
  	//window.close();
  }
  
  function setDescription(description) {
  	desc = description;
  }
  
  /*function ripDescription(ytTab) {
  	var views = chrome.extension.getViews();
  	var ytView = null;
  	
  	for(var i = 0; i < views.length; i++) {
  	  if(views[i].location.href == ytTab.url) {
  	  	ytView = views[i];
  	  	break;
  	  }
  	}
  	
  	if(ytView) {
  	  var descPar = ytView.document.getElementByID('eow-description');
  	  
  	  for(var i = 0; i < descPar.attributes.length; i++) {
  	  	if(descPar.attributes[i].name == 'textContent') {
  	  	  return descPar.attributes[i].value;
  	  	}
  	  }
  	}
  	
  	return null;
  }*/
</script>

<body>
	<button type="button" onclick="gotoCalendar()" id="goto">Go to MediaCalendar</button>
	<button type="button" onclick="openShare()" id="share">Share This Video</button>
</body>
</html>
